{layout name="common/layout" /}
<article class="test-result-page">
    <!-- è°·æ­Œå¹¿å‘Šä½ - é¡¶éƒ¨æ¨ªå¹…ï¼ˆå±•ç¤ºå¹¿å‘Šï¼‰-->
    <div class="ad-container ad-banner-top">
        <ins class="adsbygoogle"
             style="display:block"
             data-ad-client="ca-pub-9195262048954682"
             data-ad-slot="2969657271"
             data-ad-format="auto"
             data-full-width-responsive="true"></ins>
        <script>
        (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
    </div>

    <div class="container">
        <div class="row">
            <div class="col-md-12">
                <div class="test-result">
                    <!-- æµ‹è¯•æ ‡é¢˜ -->
                    <header class="test-header">
                        <h1 id="test-title">è´å…‹æŠ‘éƒé‡è¡¨ï¼ˆBDI-SFï¼‰</h1>
                        <!-- <p id="test-subtitle">æµ‹è¯•ç»“æœä»…ä¾›å‚è€ƒï¼Œå…·ä½“è¯·å’¨è¯¢ä¸“ä¸šæŒ‡å¯¼</p> -->
                    </header>
                    <!-- æµ‹è¯•ä¿¡æ¯ - æŠ˜å å¼ -->
                    <section class="test-info" id="test-info">
                        <div class="info-toggle" onclick="toggleTestInfo()">
                            <h2 id="info-header-title">æµ‹è¯•ä¿¡æ¯</h2>
                            <span class="toggle-icon" id="test-info-icon">â–¼</span>
                        </div>
                        <div class="info-content collapsed" id="info-content">
                            <!-- æµ‹è¯•ä¿¡æ¯å°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
                        </div>
                    </section>
                    
                    <!-- åˆ†æ•°æ˜¾ç¤º -->
                    <section class="score-section">
                        <div class="score-card">
                            <div class="score-circle">
                                <div class="score-number" id="total-score">0</div>
                                <div class="score-label" id="score-label">æ€»åˆ†</div>
                            </div>
                            <div class="score-info">
                                <div class="score-description" id="score-description">Loading...</div>
                                <div class="score-level" id="score-level">Evaluating...</div>
                            </div>
                        </div>
                    </section>
                    
                    
                    <!-- ç»“æœåˆ†æ -->
                    <section class="analysis-section" id="analysis-section">
                        <h2 id="analysis-header-title">è¯¦ç»†åˆ†ææŠ¥å‘Š</h2>
                        <div class="analysis-content" id="analysis-content">
                            <!-- åˆ†æå†…å®¹å°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
                        </div>
                    </section>
                    
                    <!-- å»ºè®®å’ŒæŒ‡å¯¼ -->
                    <section class="suggestions-section" id="suggestions-section">
                        <h2 id="suggestions-header-title">å»ºè®®å’ŒæŒ‡å¯¼</h2>
                        <div class="suggestions-content" id="suggestions-content">
                            <!-- å»ºè®®å†…å®¹å°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
                        </div>
                    </section>
                </div>
            </div>
        </div>
    </div>

    <!-- è°·æ­Œå¹¿å‘Šä½ - ä¸­é—´å†…å®¹ï¼ˆæ–‡ç« å†…åµŒå¹¿å‘Šï¼‰-->
    <div class="ad-container ad-banner-middle">
        <ins class="adsbygoogle"
             style="display:block; text-align:center;"
             data-ad-layout="in-article"
             data-ad-format="fluid"
             data-ad-client="ca-pub-9195262048954682"
             data-ad-slot="5294962935"></ins>
        <script>
        (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
    </div>
</article>

<style>
/* è°·æ­Œå¹¿å‘Šä½æ ·å¼ */
.ad-container {
    margin: 20px auto;
    max-width: 900px;
    text-align: center;
}

.ad-banner-top {
    margin-bottom: 30px;
}

.ad-banner-middle {
    margin: 40px auto;
}

.ad-placeholder {
    background: #f8f9fa;
    border: 2px dashed #dee2e6;
    border-radius: 8px;
    padding: 20px;
    min-height: 90px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #6c757d;
    font-size: 14px;
}

/* æ•´ä½“å®¹å™¨ */
.test-result-page {
    background: #f8f9fa;
    min-height: 100vh;
}

.test-result {
    max-width: 900px;
    margin: 0 auto;
    padding: 20px;
    background: #fff;
    border-radius: 16px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.1);
}

/* æµ‹è¯•æ ‡é¢˜ */
.test-header {
    text-align: center;
    margin-bottom: 40px;
    padding-bottom: 20px;
    border-bottom: 2px solid #f5f5f5;
}

.test-header h1 {
    color: #2c3e50;
    font-size: 2.2rem;
    font-weight: 700;
    margin-bottom: 10px;
    line-height: 1.2;
}

.test-header p {
    color: #7f8c8d;
    font-size: 1.1rem;
    margin: 0;
}

/* åˆ†æ•°æ˜¾ç¤ºåŒºåŸŸ */
.score-section {
    margin-bottom: 40px;
}

.score-card {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border-radius: 20px;
    padding: 40px;
    color: white;
    display: flex;
    align-items: center;
    gap: 40px;
    box-shadow: 0 8px 30px rgba(102, 126, 234, 0.3);
}

.score-circle {
    flex-shrink: 0;
    width: 150px;
    height: 150px;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.2);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    backdrop-filter: blur(10px);
    border: 2px solid rgba(255, 255, 255, 0.3);
}

.score-number {
    font-size: 3rem;
    font-weight: 700;
    line-height: 1;
    margin-bottom: 5px;
}

.score-label {
    font-size: 1rem;
    opacity: 0.9;
    font-weight: 500;
}

.score-info {
    flex: 1;
}

.score-description {
    font-size: 1.3rem;
    font-weight: 600;
    margin-bottom: 15px;
    line-height: 1.4;
}

.score-level {
    font-size: 1.1rem;
    opacity: 0.9;
    padding: 8px 16px;
    background: rgba(255, 255, 255, 0.2);
    border-radius: 20px;
    display: inline-block;
    backdrop-filter: blur(10px);
}

/* æµ‹è¯•ä¿¡æ¯ - æŠ˜å å¼ */
.test-info {
    margin-bottom: 40px;
}

.info-toggle {
    background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
    color: white;
    padding: 20px 25px;
    border-radius: 12px;
    cursor: pointer;
    display: flex;
    justify-content: space-between;
    align-items: center;
    transition: all 0.3s ease;
    box-shadow: 0 4px 15px rgba(40, 167, 69, 0.3);
}

.info-toggle:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(40, 167, 69, 0.4);
}

.info-toggle h2 {
    margin: 0;
    font-size: 1.3rem;
    font-weight: 600;
}

.info-content {
    background: #f8f9fa;
    border-radius: 0 0 12px 12px;
    padding: 25px;
    border-left: 5px solid #28a745;
    border-top: none;
    color: #495057;
    line-height: 1.6;
    max-height: 0;
    overflow: hidden;
    transition: max-height 0.3s ease, padding 0.3s ease;
}

.info-content.expanded {
    max-height: 2000px;
    padding: 25px;
}

.info-content.collapsed {
    max-height: 0;
    padding: 0 25px;
}

/* åˆ†æåŒºåŸŸ */
.analysis-section {
    margin-bottom: 40px;
}

.analysis-section h2 {
    color: #2c3e50;
    font-size: 1.3rem;
    font-weight: 600;
    margin-bottom: 20px;
    text-align: center;
}

.analysis-content {
    background: #fff;
    border-radius: 12px;
    padding: 25px;
    border: 1px solid #e9ecef;
    line-height: 1.7;
    color: #495057;
}

.analysis-content h4 {
    color: #2c3e50;
    font-size: 1.1rem;
    font-weight: 600;
    margin: 20px 0 10px 0;
}

.analysis-content p {
    margin-bottom: 15px;
    color: #6c757d;
}

/* å»ºè®®åŒºåŸŸ */
.suggestions-section {
    margin-bottom: 20px;
}

.suggestions-section h2 {
    color: #2c3e50;
    font-size: 1.3rem;
    font-weight: 600;
    margin-bottom: 20px;
    text-align: center;
}

.suggestions-content {
    background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
    border-radius: 12px;
    padding: 25px;
    border-left: 5px solid #28a745;
}

.suggestions-content h4 {
    color: #28a745;
    font-size: 1.1rem;
    font-weight: 600;
    margin: 15px 0 10px 0;
}

.suggestions-content p {
    margin-bottom: 12px;
    color: #495057;
    line-height: 1.6;
}

.suggestions-content ul {
    margin: 15px 0;
    padding-left: 20px;
}

.suggestions-content li {
    margin-bottom: 8px;
    color: #495057;
    line-height: 1.5;
}

/* å“åº”å¼è®¾è®¡ */
@media (max-width: 768px) {
    .test-result-page {
        padding: 0;
    }
    
    .test-result {
        padding: 15px;
        margin: 10px;
        border-radius: 12px;
    }
    
    .test-header h1 {
        font-size: 1.8rem;
    }
    
    .test-header p {
        font-size: 1rem;
    }
    
    .score-card {
        flex-direction: column;
        text-align: center;
        gap: 20px;
        padding: 30px 20px;
    }
    
    .score-circle {
        width: 120px;
        height: 120px;
    }
    
    .score-number {
        font-size: 2.5rem;
    }
    
    .score-description {
        font-size: 1.1rem;
    }
    
    .suggestions-content {
        padding: 20px;
    }
    
    .info-toggle {
        padding: 15px 20px;
    }
    
    .info-toggle h2 {
        font-size: 1.1rem;
    }
    
    .info-content.expanded {
        padding: 20px;
    }
    
    .analysis-content {
        padding: 20px;
    }
    
    .ad-container {
        margin: 15px auto;
        padding: 0 10px;
    }
    
    .ad-placeholder {
        padding: 15px;
        min-height: 80px;
    }
}

@media (max-width: 480px) {
    .test-result {
        padding: 12px;
        margin: 5px;
        border-radius: 8px;
    }
    
    .test-header h1 {
        font-size: 1.6rem;
    }
    
    .test-header p {
        font-size: 0.9rem;
    }
    
    .score-card {
        padding: 25px 15px;
    }
    
    .score-circle {
        width: 100px;
        height: 100px;
    }
    
    .score-number {
        font-size: 2rem;
    }
    
    .info-toggle {
        padding: 12px 15px;
    }
    
    .info-toggle h2 {
        font-size: 1rem;
    }
    
    .info-content.expanded {
        padding: 15px;
    }
    
    .analysis-content {
        padding: 15px;
    }
    
    .suggestions-content {
        padding: 15px;
    }
    
    .ad-placeholder {
        padding: 10px;
        min-height: 70px;
        font-size: 12px;
    }
}

/* æ—§æ ·å¼è¦†ç›– */
.result-container {
    max-width: 800px;
    margin: 0 auto;
    padding: 20px;
}

.result-header {
    text-align: center;
    margin-bottom: 30px;
}

.result-header h2 {
    color: #333;
    margin-bottom: 10px;
}

.result-subtitle {
    color: #666;
    font-size: 16px;
}

.score-display {
    text-align: center;
    margin-bottom: 30px;
    padding: 40px;
    background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
    border-radius: 15px;
    color: white;
}

.total-score {
    font-size: 72px;
    font-weight: bold;
    margin-bottom: 15px;
    text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
}

.score-description {
    font-size: 20px;
    opacity: 0.9;
}

.score-details {
    margin-bottom: 30px;
}

.score-breakdown {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 20px;
    margin-top: 20px;
}

.score-item {
    background: #f8f9fa;
    padding: 20px;
    border-radius: 10px;
    text-align: center;
    border-left: 4px solid #28a745;
}

.score-label {
    font-weight: bold;
    color: #333;
    margin-bottom: 10px;
}

.score-value {
    font-size: 24px;
    color: #28a745;
    font-weight: bold;
}

.score-analysis {
    background: #fff;
    padding: 30px;
    border-radius: 15px;
    box-shadow: 0 4px 6px rgba(0,0,0,0.1);
}

.analysis-section h3 {
    color: #333;
    margin-bottom: 20px;
    border-bottom: 2px solid #28a745;
    padding-bottom: 10px;
}

.analysis-content {
    line-height: 1.8;
    color: #555;
}

.analysis-content h4 {
    color: #333;
    margin-top: 20px;
    margin-bottom: 10px;
}

.analysis-content p {
    margin-bottom: 15px;
}

.rating-badge {
    display: inline-block;
    padding: 8px 16px;
    background: #28a745;
    color: white;
    border-radius: 20px;
    font-weight: bold;
    margin-top: 10px;
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // è·å–URLå‚æ•°
    const urlParams = new URLSearchParams(window.location.search);
    const answer_id = urlParams.get('answer_id');
    
    if (!answer_id) {
        document.getElementById('score-result').innerHTML = '<div class="alert alert-danger">æœªæ‰¾åˆ°æµ‹è¯•ç»“æœ</div>';
        return;
    }
    
    // è·å–URLå‚æ•°ä¸­çš„è¯­è¨€
    const lg = urlParams.get('lg') || 'zh-cn';
    
    // è·å–æµ‹è¯•ç»“æœ
    fetch('/addons/cms/psychometry/answerInfo', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/x-www-form-urlencoded',
        },
        body: 'answer_id=' + answer_id + '&lang=' + lg
    })
    .then(response => response.json())
    .then(data => {
        if (data.code === 1) {
            displayScoreResult(data.data);
        } else {
            document.getElementById('score-result').innerHTML = '<div class="alert alert-danger">è·å–ç»“æœå¤±è´¥ï¼š' + data.msg + '</div>';
        }
    })
    .catch(error => {
        console.error('Error:', error);
        document.getElementById('score-result').innerHTML = '<div class="alert alert-danger">ç½‘ç»œé”™è¯¯ï¼Œè¯·ç¨åé‡è¯•</div>';
    });
});

function displayScoreResult(data) {
    // è·å–è¯­è¨€å‚æ•°
    const lg = new URLSearchParams(window.location.search).get('lg');
    const isEnglish = lg === 'en';
    
    // æ›´æ–°UIè¯­è¨€
    updateUILanguage(isEnglish, data);
    
    // æ›´æ–°é¡µé¢æ ‡é¢˜
    if (data.a_info) {
        document.getElementById('test-title').textContent = data.a_info.title || (isEnglish ? 'Score Test Result' : 'åˆ†æ•°æµ‹è¯•ç»“æœ');
    }
    
    // æ˜¾ç¤ºæ€»åˆ†
    const totalScore = data.max_score || 0;
    document.getElementById('total-score').textContent = totalScore;
    
    // æ˜¾ç¤ºå¾—åˆ†æè¿°å’Œç­‰çº§
    const scoreInfo = getScoreInfo(totalScore, data, isEnglish);
    document.getElementById('score-description').innerHTML = scoreInfo.description;
    document.getElementById('score-level').textContent = scoreInfo.level;
    
    // æ˜¾ç¤ºæµ‹è¯•ä¿¡æ¯
    displayTestInfo(data, isEnglish);
    
    // æ˜¾ç¤ºåˆ†æå†…å®¹
    displayAnalysis(data, isEnglish);
    
    // æ˜¾ç¤ºå»ºè®®å’ŒæŒ‡å¯¼
    displaySuggestions(data, isEnglish);
}

// æ›´æ–°UIè¯­è¨€
function updateUILanguage(isEnglish, data) {
    const texts = {
        zh: {
            testResult: 'æµ‹è¯•ç»“æœ',
            testInfo: 'æµ‹è¯•ä¿¡æ¯',
            totalScore: 'æ€»åˆ†',
            analysisReport: 'è¯¦ç»†åˆ†ææŠ¥å‘Š',
            suggestions: 'å»ºè®®å’ŒæŒ‡å¯¼',
            loading: 'æ­£åœ¨è®¡ç®—æ‚¨çš„å¾—åˆ†...',
            evaluating: 'è¯„ä¼°ä¸­...',
            testName: 'æµ‹è¯•åç§°ï¼š',
            testDescription: 'æµ‹è¯•è¯´æ˜ï¼š',
            questionCount: 'é¢˜ç›®æ•°é‡ï¼š',
            maxScore: 'æ»¡åˆ†ï¼š',
            testType: 'æµ‹è¯•ç±»å‹ï¼š',
            scoreTest: 'åˆ†æ•°æµ‹è¯•',
            questions: ' é¢˜',
            score: ' åˆ†',
            yourScore: 'æ‚¨çš„æ€»å¾—åˆ†ä¸ºï¼š',
            scoreRate: 'å¾—åˆ†ç‡ä¸ºï¼š',
            resultExplanation: 'ç»“æœè¯´æ˜',
            referenceNote: 'æµ‹è¯•ç»“æœä»…ä¾›å‚è€ƒï¼Œå¦‚éœ€ä¸“ä¸šæŒ‡å¯¼ï¼Œè¯·å’¨è¯¢ç›¸å…³é¢†åŸŸçš„ä¸“å®¶ã€‚',
            excellent: 'ä¼˜ç§€',
            excellentDesc: 'æ‚¨çš„å¾—åˆ†éå¸¸ä¼˜ç§€ï¼',
            good: 'è‰¯å¥½',
            goodDesc: 'æ‚¨çš„å¾—åˆ†è¡¨ç°è‰¯å¥½ã€‚',
            average: 'ä¸­ç­‰',
            averageDesc: 'æ‚¨çš„å¾—åˆ†å¤„äºä¸­ç­‰æ°´å¹³ã€‚',
            pass: 'åŠæ ¼',
            passDesc: 'æ‚¨çš„å¾—åˆ†è¾¾åˆ°åŠæ ¼æ°´å¹³ã€‚',
            needImprovement: 'éœ€è¦æ”¹è¿›',
            needImprovementDesc: 'æ‚¨çš„å¾—åˆ†è¿˜æœ‰æå‡ç©ºé—´ã€‚',
            generalSuggestions: 'ğŸ’¡ é€šç”¨å»ºè®®',
            notes: 'ğŸ“ æ³¨æ„äº‹é¡¹',
            defaultDescription: 'é€šè¿‡ä¸“ä¸šçš„å¿ƒç†å­¦é‡è¡¨ï¼Œå¸®åŠ©æ‚¨äº†è§£è‡ªå·±åœ¨ç›¸å…³æ–¹é¢çš„è¡¨ç°å’Œæ°´å¹³ã€‚'
        },
        en: {
            testResult: 'Test Result',
            testInfo: 'Test Information',
            totalScore: 'Total Score',
            analysisReport: 'Detailed Analysis Report',
            suggestions: 'Suggestions',
            loading: 'Calculating your score...',
            evaluating: 'Evaluating...',
            testName: 'Test Name: ',
            testDescription: 'Description: ',
            questionCount: 'Questions: ',
            maxScore: 'Max Score: ',
            testType: 'Test Type: ',
            scoreTest: 'Score Test',
            questions: ' questions',
            score: ' points',
            yourScore: 'Your total score: ',
            scoreRate: 'Score rate: ',
            resultExplanation: 'Result Explanation',
            referenceNote: 'Test results are for reference only. Please consult a professional for specific guidance.',
            excellent: 'Excellent',
            excellentDesc: 'Your score is excellent!',
            good: 'Good',
            goodDesc: 'Your score is good.',
            average: 'Average',
            averageDesc: 'Your score is at an average level.',
            pass: 'Pass',
            passDesc: 'Your score meets the passing standard.',
            needImprovement: 'Need Improvement',
            needImprovementDesc: 'Your score has room for improvement.',
            generalSuggestions: 'ğŸ’¡ General Suggestions',
            notes: 'ğŸ“ Notes',
            defaultDescription: 'Through professional psychological scales, help you understand your performance and level in related aspects.'
        }
    };
    
    const t = isEnglish ? texts.en : texts.zh;
    
    // æ›´æ–°å„ä¸ªåŒºåŸŸæ ‡é¢˜
    document.getElementById('info-header-title').textContent = t.testInfo;
    document.getElementById('score-label').textContent = t.totalScore;
    document.getElementById('analysis-header-title').textContent = t.analysisReport;
    document.getElementById('suggestions-header-title').textContent = t.suggestions;
    
    // ä¿å­˜æ–‡æœ¬åˆ°å…¨å±€å˜é‡ï¼Œä¾›å…¶ä»–å‡½æ•°ä½¿ç”¨
    window.i18nTexts = t;
}

function getScoreInfo(score, data, isEnglish) {
    const t = window.i18nTexts;
    
    // å¦‚æœæœ‰analyseæ•°æ®ï¼Œä¼˜å…ˆä½¿ç”¨
    if (data.analyse && data.analyse.title) {
        return {
            level: data.analyse.title,
            description: data.analyse.intro || t.referenceNote
        };
    }
    
    // æ ¹æ®åˆ†æ•°èŒƒå›´æä¾›é€šç”¨è¯„ä¼°
    const maxScore = data.max_score || 100;
    const percentage = (score / maxScore) * 100;
    
    if (percentage >= 90) {
        return {
            level: t.excellent,
            description: t.excellentDesc
        };
    } else if (percentage >= 80) {
        return {
            level: t.good,
            description: t.goodDesc
        };
    } else if (percentage >= 70) {
        return {
            level: t.average,
            description: t.averageDesc
        };
    } else if (percentage >= 60) {
        return {
            level: t.pass,
            description: t.passDesc
        };
    } else {
        return {
            level: t.needImprovement,
            description: t.needImprovementDesc
        };
    }
}

function displayTestInfo(data, isEnglish) {
    const t = window.i18nTexts;
    let infoHtml = '';
    
    if (data.a_info) {
        infoHtml += '<p><strong>' + t.testName + '</strong>' + (data.a_info.title || t.scoreTest) + '</p>';
        
        // ä¼˜å…ˆä½¿ç”¨sub_titleï¼Œå¦‚æœæ²¡æœ‰åˆ™ä½¿ç”¨descriptionï¼Œæœ€åä½¿ç”¨é»˜è®¤æè¿°
        let description = data.a_info.sub_title || data.a_info.description || '';
        if (description === 'é»˜è®¤æè¿°' || description === '') {
            description = t.defaultDescription;
        }
        infoHtml += '<p><strong>' + t.testDescription + '</strong>' + description + '</p>';
        
        infoHtml += '<p><strong>' + t.questionCount + '</strong>' + (data.test_info?.question_count || 0) + t.questions + '</p>';
        
        // è®¡ç®—ç†è®ºæ»¡åˆ†ï¼ˆé¢˜ç›®æ•°é‡ Ã— æ¯é¢˜æœ€é«˜åˆ†ï¼‰
        const questionCount = data.test_info?.question_count || 0;
        const maxScorePerQuestion = 1; // å‡è®¾æ¯é¢˜æœ€é«˜1åˆ†
        const theoreticalMaxScore = questionCount * maxScorePerQuestion;
        infoHtml += '<p><strong>' + t.maxScore + '</strong>' + theoreticalMaxScore + t.score + '</p>';
        
        infoHtml += '<p><strong>' + t.testType + '</strong>' + t.scoreTest + '</p>';
    }
    
    document.getElementById('info-content').innerHTML = infoHtml;
}

function displayAnalysis(data, isEnglish) {
    const t = window.i18nTexts;
    let analysisHtml = '';
    
    // å¦‚æœæœ‰analyseæ•°æ®ï¼Œä¼˜å…ˆæ˜¾ç¤º
    if (data.analyse && data.analyse.content) {
        analysisHtml = data.analyse.content;
    } else if (data.analyse && data.analyse.analysis) {
        analysisHtml = data.analyse.analysis;
    } else {
        // æ˜¾ç¤ºåŸºæœ¬ä¿¡æ¯
        const totalScore = data.max_score || 0;
        const percentage = totalScore > 0 ? Math.round((totalScore / data.max_score) * 100) : 0;
        
        analysisHtml = `
            <h4>${t.testResult}</h4>
            <p>${t.yourScore}<strong>${totalScore}</strong>${t.score}</p>
            <p>${t.scoreRate}<strong>${percentage}%</strong></p>
            
            <h4>${t.resultExplanation}</h4>
            <p>${t.referenceNote}</p>
        `;
    }
    
    document.getElementById('analysis-content').innerHTML = analysisHtml;
}

function displaySuggestions(data, isEnglish) {
    const t = window.i18nTexts;
    let suggestionsHtml = '';
    
    // å¦‚æœæœ‰analyseæ•°æ®ä¸­çš„å»ºè®®ï¼Œä¼˜å…ˆæ˜¾ç¤º
    if (data.analyse && data.analyse.suggestion) {
        suggestionsHtml = data.analyse.suggestion;
    } else {
        // æ˜¾ç¤ºé€šç”¨å»ºè®®ï¼ˆå¤šè¯­è¨€ï¼‰
        if (isEnglish) {
            suggestionsHtml = `
                <h4>ğŸ’¡ General Suggestions</h4>
                <ul>
                    <li>Understand your current status based on test results</li>
                    <li>Consult relevant professionals if you have any questions</li>
                    <li>Maintain a positive mindset and continue to focus on personal development</li>
                    <li>Conduct regular self-assessment and reflection</li>
                </ul>
                
                <h4>ğŸ“ Notes</h4>
                <p>Test results are for reference only. Please consult a professional for specific guidance.</p>
            `;
        } else {
            suggestionsHtml = `
                <h4>ğŸ’¡ é€šç”¨å»ºè®®</h4>
                <ul>
                    <li>æ ¹æ®æµ‹è¯•ç»“æœï¼Œäº†è§£è‡ªå·±çš„ç°çŠ¶</li>
                    <li>å¦‚æœ‰ç–‘é—®ï¼Œå»ºè®®å’¨è¯¢ç›¸å…³ä¸“ä¸šäººå£«</li>
                    <li>ä¿æŒç§¯æçš„å¿ƒæ€ï¼ŒæŒç»­å…³æ³¨è‡ªèº«å‘å±•</li>
                    <li>å®šæœŸè¿›è¡Œè‡ªæˆ‘è¯„ä¼°å’Œåæ€</li>
                </ul>
                
                <h4>ğŸ“ æ³¨æ„äº‹é¡¹</h4>
                <p>æµ‹è¯•ç»“æœä»…ä¾›å‚è€ƒï¼Œå…·ä½“è¯·å’¨è¯¢ä¸“ä¸šæŒ‡å¯¼ã€‚</p>
            `;
        }
    }
    
    document.getElementById('suggestions-content').innerHTML = suggestionsHtml;
}

// æŠ˜å åŠŸèƒ½
function toggleTestInfo() {
    const content = document.getElementById('info-content');
    const icon = document.getElementById('test-info-icon');
    
    if (content.classList.contains('collapsed')) {
        content.classList.remove('collapsed');
        content.classList.add('expanded');
        icon.classList.add('expanded');
    } else {
        content.classList.remove('expanded');
        content.classList.add('collapsed');
        icon.classList.remove('expanded');
    }
}

</script>
