{layout name="common/layout" /}
 <div id="app" v-cloak class="hidden">
     <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8" id="content-container">
         <nav aria-label="breadcrumb" class="mt-6">
             <ol class="flex flex-wrap items-center gap-x-2 gap-y-1 text-sm text-gray-600">
                 {cms:breadcrumb id="item"}
                 <li class="inline-flex items-center">
                     <a class="hover:text-emerald-600" href="{$item.url}">{:__($item.name)}</a>
                 </li>
                 {/cms:breadcrumb}
             </ol>
         </nav>

         <div class="mt-6 grid gap-6 lg:grid-cols-12">
             <main class="lg:col-span-8">
                 <article class="rounded-lg border border-gray-200 bg-white shadow-sm">
                     <header class="space-y-4 border-b border-gray-100 p-4">
                         <div class="flex items-start gap-4">
                             <div class="w-20 shrink-0 sm:w-24">
                                 <div class="aspect-[1/1] overflow-hidden rounded-lg bg-gray-100">
                                     <img src="{cms:archives name='image|cdnurl'}" alt="{cms:archives name='title|htmlentities' /}" loading="lazy" class="h-full w-full object-cover">
                                 </div>
                             </div>

                             <div class="min-w-0 flex-1 space-y-3">
                                 <h1 class="text-xl font-bold leading-7 text-gray-900" {if $__ARCHIVES__.style}style="{$__ARCHIVES__.style_text}"{/if}>{cms:archives name="title|htmlentities" /}</h1>
                                 <button type="button" class="inline-flex items-center rounded-md bg-emerald-600 px-5 py-2.5 text-sm font-semibold text-white hover:bg-emerald-700" @click="toTest">{:__('立即测试')}</button>
                             </div>
                         </div>

                         <p class="text-sm leading-7 text-gray-600">{cms:archives name="sub_title|htmlentities" /}</p>
                     </header>

                     <div class="space-y-6 p-4">
                         <div class="text-sm leading-7 text-gray-700">
                             {cms:archives name="content" /}
                         </div>

                         <div>
                             <button type="button" class="inline-flex w-full items-center justify-center rounded-md bg-emerald-600 px-5 py-2.5 text-sm font-semibold text-white hover:bg-emerald-700 sm:w-auto" @click="toTest">{:__('立即测试')}</button>
                         </div>
                     </div>
                 </article>
             </main>

             <aside class="lg:col-span-4">
                 <section aria-label="{:__('MBTI专区')}" class="rounded-lg border border-gray-200 bg-white shadow-sm">
                     <div class="border-b border-gray-100 px-4 py-3">
                         <h2 class="text-base font-semibold text-gray-900">{:__('MBTI专区')}</h2>
                     </div>
                     <div class="grid grid-cols-1 gap-4 p-4">
                         {cms:arclist id="item" channel="10" length="8" row="6"}
                         {include file="common/item_mbti"}
                         {/cms:arclist}
                     </div>
                 </section>
             </aside>
         </div>
     </div>
 </div>
<script type="text/javascript" src="__ADDON__/js/vue.js"></script>
<script type="text/javascript" src="__ADDON__/js/vue-index.js"></script>
<script>
    var currentDomain = window.location.hostname;
     new Vue({
         el: '#app',
         data: {
             qid: '',
             quesInfo: '',
             isMobile: false,
             authCode: 0
         },
         mounted() {
             this.$el.classList.remove('hidden');
             this.isMobile = window.innerWidth <= 992;
             window.addEventListener('resize', () => {
                 this.isMobile = window.innerWidth <= 992;
             });
            var url = window.location.href;
            const parsedUrl = new URL(url);
            const pathnameParts = parsedUrl.pathname.split("/");
            const filename = pathnameParts[pathnameParts.length - 1];
            this.qid = filename.split(".")[0];
            this.getQuestions();
         },
         methods: {
             toTest() {
                 // 使用完整的URL，包含端口号
                 const baseUrl = window.location.protocol + '//' + window.location.host;
                 window.location.href = `${baseUrl}/question.html?qid=${this.qid}`;
             },

            getQuestions() {
                const params = new URLSearchParams();
                params.append('aid', this.qid);
                fetch('/addons/cms/psychometry/getQuestions?', {
                    method: 'POST',
                    body: params,
                })
                .then(response => response.json())
                .then(data => {
                    this.quesInfo = data.data.data;
                    this.productInfo = data.data.data.exam_info;
                })
                .catch(error => {
                    console.error('Error fetching data:', error);
                });
            },
         }
     });
</script>