{layout name="common/layout" /}
<style>
    [v-cloak] {
        display: none;
    }

    .entry-box .media-heading {
        font-size: 20px !important;
    }

    .media-btn {
        margin-top: 40px;
    }

    .media-image {
        width: 100px;
        height: 100px;
    }

    @media (max-width: 468px) {
        .media-btn {
            width: 100%;
            margin-top: 20px;
        }

        .media-image {
            width: 80px;
            height: 80px;
        }

        .paybtn {
            padding: 0;
        }
    }

    .btn:hover,
    .btn:focus,
    .btn.focus {
        color: #fff;
    }

</style>
<div id="app" v-cloak>
    <div class="container" id="content-container">
        <div class="row">
            <main class="col-xs-12 col-md-8">
                <div class="panel panel-default article-content">
                    <div class="panel-heading">
                        <ol class="breadcrumb">
                            {cms:breadcrumb id="item"}
                            <li><a href="{$item.url}">{:__($item.name)}</a></li>
                            {/cms:breadcrumb}
                        </ol>
                    </div>
                    <div class="panel-body">
                        <div class="media entry-box">
                            <div class="media-left">
                                <div class="media-image">
                                    <div class="embed-responsive embed-responsive-square">
                                        <img class="embed-responsive-image" src="{cms:archives name='image|cdnurl'}">
                                    </div>
                                </div>
                            </div>
                            <div class="media-body">
                                <h1 class="media-heading" {if $__ARCHIVES__.style}style="{$__ARCHIVES__.style_text}"
                                    {/if}>{cms:archives name="title|htmlentities" /}</h1>

                                    <div class="panel panel-default">
                                        <div class="paybtn mt-4 btn1" @click="toTest">{:__('立即测试')}</div>
                                    </div>
                            </div>
                            <div class="media-content" style="color: #666;font-size: 13px;">
                                {cms:archives name="sub_title|htmlentities" /}
                            </div>
                        </div>
                    </div>
                    <div class="panel-body" style="position: relative;">
                            <div>
                                <p>
                                    {cms:archives name="content" /}
                                </p>
                            </div>
                        <div class="panel panel-default">
                            <div class="paybtn mt-3 btn1" @click="toTest">{:__('立即测试')}</div>
                        </div>
                    </div>
            </main>
            <aside class="col-xs-12 col-md-4">
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <h3 class="panel-title">{:__('MBTI专区')}</h3>
                    </div>
                    <div class="panel-body p-0">
                        <div class="row">
                            <div class="article-list">
                                {cms:arclist id="item" channel="10" length="8" row="6"}
                                <div class="col-xs-12 product-item">
                                    {include file="common/item_mbti"}
                                </div>
                                {/cms:arclist}
                            </div>
                        </div>
                    </div>
                </div>
            </aside>
        </div>
    </div>
</div>
<script type="text/javascript" src="__ADDON__/js/vue.js"></script>
<script type="text/javascript" src="__ADDON__/js/vue-index.js"></script>
<script>
    var currentDomain = window.location.hostname;
    new Vue({
        el: '#app',
        data: {
            qid: '',
            quesInfo: '',
            isMobile: false,
            authCode: 0
        },
        mounted() {
            this.isMobile = window.innerWidth <= 992;
            window.addEventListener('resize', () => {
                this.isMobile = window.innerWidth <= 992;
            });
            var url = window.location.href;
            const parsedUrl = new URL(url);
            const pathnameParts = parsedUrl.pathname.split("/");
            const filename = pathnameParts[pathnameParts.length - 1];
            this.qid = filename.split(".")[0];
            this.getQuestions();
        },
        methods: {
            toTest() {
                // 使用完整的URL，包含端口号
                const baseUrl = window.location.protocol + '//' + window.location.host;
                window.location.href = `${baseUrl}/question.html?qid=${this.qid}`;
            },
         
            getQuestions() {
                const params = new URLSearchParams();
                params.append('aid', this.qid);
                fetch('/addons/cms/psychometry/getQuestions?', {
                    method: 'POST',
                    body: params,
                })
                .then(response => response.json())
                .then(data => {
                    this.quesInfo = data.data.data;
                    this.productInfo = data.data.data.exam_info;
                })
                .catch(error => {
                    console.error('Error fetching data:', error);
                });
            },
        }
    });
</script>