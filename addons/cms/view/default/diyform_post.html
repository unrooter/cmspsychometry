{layout name="common/layout" /}

<link rel="stylesheet" href="__CDN__/assets/libs/toastr/toastr.min.css">
<link rel="stylesheet" href="__CDN__/assets/libs/eonasdan-bootstrap-datetimepicker/build/css/bootstrap-datetimepicker.min.css">
<link rel="stylesheet" href="__CDN__/assets/libs/bootstrap-daterangepicker/daterangepicker.css">
<link rel="stylesheet" href="__CDN__/assets/libs/nice-validator/dist/jquery.validator.css">
<link rel="stylesheet" href="__CDN__/assets/libs/fastadmin-selectpage/selectpage.css">
<link rel="stylesheet" href="__CDN__/assets/libs/bootstrap-select/dist/css/bootstrap-select.min.css">

{if $Think.get.noframe}
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const header = document.querySelector('header');
        const footer = document.querySelector('footer');
        const backToTop = document.getElementById('back-to-top');
        const mainContent = document.querySelector('main.main-content');

        if (header) header.classList.add('hidden');
        if (footer) footer.classList.add('hidden');
        if (backToTop) backToTop.classList.add('hidden');
        if (mainContent) mainContent.classList.add('pb-0');

        document.body.classList.add('pt-0');
    });
</script>
{/if}
<!--@formatter:off-->
<script type="application/json" id="require-config-json">{$jsconfig|json_encode}</script>
<script type="text/javascript">
    var require = {
        config: JSON.parse(document.getElementById('require-config-json').textContent)
    };
</script>
<!--@formatter:on-->

<div class="mx-auto max-w-3xl px-4 py-6 sm:px-6 lg:px-8" id="content-container">
    <section class="overflow-hidden rounded-2xl border border-gray-200 bg-white shadow-sm">
        <div class="border-b border-gray-100 px-5 py-4 text-center">
            <h1 class="text-xl font-bold tracking-tight text-gray-900 sm:text-2xl">
                {$__DIYFORM__['posttitle']}
            </h1>
        </div>
        <div class="px-5 py-6">
            <!-- S 正文 -->

            <form id="post-form" role="form" data-toggle="validator" method="POST" class="space-y-6">
                <input type="hidden" name="__diyname__" value="{$__DIYFORM__['diyname']}">
                {:token()}

                {cms:diyform name="fieldslist" /}

                {if $__DIYFORM__->iscaptcha}
                <div class="space-y-2 sm:grid sm:grid-cols-12 sm:items-start sm:gap-x-6">
                    <div class="text-sm font-medium text-gray-700 sm:col-span-3 sm:pt-2">验证码</div>
                    <div class="sm:col-span-9">
                        <a href="javascript:" class="hidden" data-event data-url></a>
                        <div class="relative flex flex-wrap items-stretch gap-2">
                            <input type="text" name="captcha" id="c-captcha" class="min-w-0 flex-1 rounded-md border border-gray-300 bg-white px-3 py-2 text-sm text-gray-900 shadow-sm focus:border-emerald-500 focus:outline-none focus:ring-2 focus:ring-emerald-500/20" data-rule="required;length({$Think.config.captcha.length})"/>
                            <button type="button" class="overflow-hidden rounded-md border border-gray-200 bg-white shadow-sm" onclick="var img=this.querySelector('img'); if(img){ img.src = '{:captcha_src()}?r=' + Math.random(); }">
                                <img src="{:captcha_src()}" width="100" height="31" alt="captcha" />
                            </button>
                            <span class="msg-box n-right" for="c-captcha"></span>
                        </div>
                    </div>
                </div>
                {/if}

                <div class="pt-2 text-center">
                    <div class="inline-flex flex-wrap items-center justify-center gap-3">
                        <button type="submit" class="disabled inline-flex items-center rounded-md bg-emerald-600 px-5 py-2.5 text-sm font-semibold text-white shadow-sm hover:bg-emerald-700">{:__('OK')}</button>
                        <button type="reset" class="inline-flex items-center rounded-md border border-gray-300 bg-white px-5 py-2.5 text-sm font-semibold text-gray-700 shadow-sm hover:bg-gray-50">{:__('Reset')}</button>
                    </div>
                </div>
            </form>

            <!-- E 正文 -->
        </div>
    </section>
</div>
<script data-render="script">
    $(function () {
        //避免Bootstrap和RequireJS中引入的Bootstrap事件冲突
        $(document).off('click.bs.dropdown.data-api');
    });
    require.callback = function () {
        define('diyform/index', ['jquery', 'bootstrap', 'frontend', 'form'], function ($, undefined, Frontend, Form) {
            var Controller = {
                index: function () {
                    Layer.config({focusBtn: false});
                    Form.api.bindevent($("form[role=form]"), function (data, ret) {
                        Layer.alert(ret.msg, {
                            end: function () {
                                location.href = ret.url;
                            }
                        });
                        return false;
                    });
                }
            };
            return Controller;
        });
    }
</script>

<script data-render="script" src="__CDN__/assets/js/require{$Think.config.app_debug?'':'.min'}.js" data-main="__CDN__/assets/js/require-frontend{$Think.config.app_debug?'':'.min'}.js?v={$site.version}"></script>
