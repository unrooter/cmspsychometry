{layout name="common/layout" /}

<!-- SEO结构化数据 -->
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "CollectionPage",
  "name": "{$__CHANNEL__.seotitle ?: $__CHANNEL__.name}",
  "description": "{$__CHANNEL__.description}",
  "url": "{$__CHANNEL__.url}"
}
</script>

<div class="mx-auto max-w-7xl px-4 py-10 sm:px-6 lg:px-8" id="content-container" itemscope itemtype="https://schema.org/CollectionPage">

    <nav aria-label="breadcrumb" class="mb-6">
        <ol class="flex flex-wrap items-center gap-x-1.5 gap-y-1 text-xs text-gray-500" itemscope itemtype="https://schema.org/BreadcrumbList">
            {php}$breadPos = 0;{/php}
            {cms:breadcrumb id="item"}
            {php}$breadPos++;{/php}
            <li class="inline-flex items-center" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
                {if $breadPos>1}<span class="mx-1 text-gray-300">›</span>{/if}
                <a class="no-underline hover:text-black" href="{$item.url}" itemprop="item"><span itemprop="name">{:__($item.name)}</span></a>
                <meta itemprop="position" content="{$breadPos}" />
            </li>
            {/cms:breadcrumb}
        </ol>
    </nav>

    <!-- 子栏目导航（仅父栏目显示子栏目） -->
    {php}$hasSubChannels = false;{/php}
    {cms:channellist id="subchan_check" type="son" typeid="$__CHANNEL__.id" limit="1"}
    {php}$hasSubChannels = true;{/php}
    {/cms:channellist}

    <header class="ui-card mt-4">
        <div class="ui-card-body">
        <div class="flex flex-wrap items-center gap-3">
            <h1 class="text-lg font-semibold tracking-tight text-gray-900" itemprop="name">{:__($__CHANNEL__.name)}</h1>
        </div>

        {if $__CHANNEL__.description}
        <div class="mt-3 text-sm leading-7 text-gray-700" itemprop="description">{$__CHANNEL__.description}</div>
        {/if}

        {if $hasSubChannels}
        <nav class="mt-4 flex flex-wrap items-center gap-2" aria-label="{:__('栏目分类')}">
            <span class="inline-flex items-center gap-2 text-xs font-semibold tracking-[0.14em] text-gray-800/90"><i class="fa fa-th-large" aria-hidden="true"></i>{:__('栏目分类')}</span>
            {cms:channellist id="subchan" type="son" typeid="$__CHANNEL__.id"}
            <a href="{$subchan.url}" class="ui-pill text-xs tracking-[0.14em] {if $subchan.id == $__CHANNEL__.id}ui-pill-active{/if}">{:__($subchan.name)}</a>
            {/cms:channellist}
        </nav>
        {/if}
        </div>
    </header>

    
    {if $__FILTERLIST__}
    <section class="mt-4" aria-label="{:__('筛选条件')}">
        <div class="ui-card">
            <div class="ui-card-body">
            <div class="flex flex-wrap items-center justify-between gap-3">
                <h2 class="inline-flex items-center gap-2 text-xs font-semibold tracking-[0.18em] text-gray-900"><i class="fa fa-filter text-black/60" aria-hidden="true"></i>{:__('筛选')}</h2>
                <form action="" id="multipleform" class="flex items-center gap-2">
                    <input type="checkbox" name="multiple" id="multiple"
                           class="h-4 w-4 rounded border-gray-300 text-gray-600 focus:ring-gray-600"
                           onclick="document.getElementById('multipleform').submit();"
                           value="{:$Think.get.multiple?0:1}"
                           {:$Think.get.multiple?'checked':''}>
                    <label for="multiple" class="text-sm text-gray-700">{:__('多选模式')}</label>
                </form>
            </div>

            <div class="mt-4 space-y-4">
                {cms:pagefilter id="filter" exclude=""}
                <div class="flex flex-wrap items-start gap-3">
                    <div class="mt-1 w-20 shrink-0 text-sm font-medium text-gray-700">{$filter.title|htmlentities}:</div>
                    <div class="flex flex-wrap gap-2">
                        {volist name="$filter.content" id="filterItem"}
                        <a href="{$filterItem.url}" class="rounded-full border border-gray-200 bg-white px-3 py-1 text-xs tracking-[0.14em] text-gray-800/90 hover:bg-gray-50 hover:text-black no-underline {$filterItem.active?'bg-gray-50 text-gray-900 border-gray-200':''}">{$filterItem.title|htmlentities}</a>
                        {/volist}
                    </div>
                </div>
                {/cms:pagefilter}
            </div>
            </div>
        </div>
    </section>
    {/if}

    <div class="mt-6 grid gap-6 lg:grid-cols-12">

        <main class="lg:col-span-8">
            <section aria-label="{:__('列表')}">
                <div class="ui-card">
                    <div class="ui-card-header flex flex-wrap items-center justify-between gap-3">
                        <h2 class="text-xs font-semibold tracking-[0.18em] text-gray-900">{:__('列表')}</h2>
                        <div class="flex flex-wrap gap-2">
                            <!-- S 排序 -->
                            {cms:pageorder id="order"}
                            <a href="{$order.url}" class="ui-pill text-xs tracking-[0.14em] {$order.active?'ui-pill-active':''}">{$order.title|htmlentities}</a>
                            {/cms:pageorder}
                            <!-- E 排序 -->
                        </div>
                    </div>
                    <div class="ui-card-body">
                        <div class="divide-y divide-gray-100" itemscope itemtype="https://schema.org/ItemList">
                            <meta itemprop="name" content="{:__($__CHANNEL__.name)}文章列表" />
                            <!-- S 列表 -->
                            {cms:pagelist id="item"}
                                {include file="common/item_news"}
                            {/cms:pagelist}
                            <!-- E 列表 -->
                        </div>

                        <!-- S 分页 -->
                        <div class="mt-8">
                            {include file="common/pageinfo" /}
                        </div>
                        <!-- E 分页 -->
                    </div>
                </div>
            </section>
        </main>

        <aside class="space-y-6 lg:col-span-4">
            <!-- 判断是否有子栏目 -->
            {php}$hasSubChannels = false;{/php}
            {cms:channellist id="subchan_check" type="son" typeid="$__CHANNEL__.id" limit="1"}
            {php}$hasSubChannels = true;{/php}
            {/cms:channellist}
            
            <!-- 栏目导航 -->
            {php}
            // 判断显示哪种导航
            $showNav = false;
            $navType = '';
            $navParentId = 0;
            
            if ($hasSubChannels) {
                // 父栏目：显示子栏目
                $showNav = true;
                $navType = 'sub';
                $navParentId = $__CHANNEL__['id'];
            } elseif (isset($__CHANNEL__['parent_id']) && $__CHANNEL__['parent_id'] > 0) {
                // 子栏目：显示兄弟栏目
                $showNav = true;
                $navType = 'sibling';
                $navParentId = $__CHANNEL__['parent_id'];
            }
            {/php}
            
            {if $showNav}
            <section aria-labelledby="sidebar-nav-title">
                <div class="ui-card">
                    <h3 class="ui-card-header text-xs font-semibold tracking-[0.18em] text-gray-900" id="sidebar-nav-title"><i class="fa fa-sitemap mr-2 text-black/60" aria-hidden="true"></i>{if $navType == 'sub'}{:__('子栏目')}{else}{:__('相关栏目')}{/if}</h3>
                    <nav class="p-2">
                        {cms:channellist id="navItem" type="son" typeid="$navParentId"}
                        <a href="{$navItem.url}" title="{:__($navItem.name)}" class="flex items-center gap-3 rounded-md px-3 py-3 text-sm text-gray-800/90 hover:bg-gray-50 hover:text-black no-underline {if $navItem.id == $__CHANNEL__.id}bg-gray-50 text-gray-900{/if}">
                            <i class="fa fa-folder-o text-black/60" aria-hidden="true"></i>
                            <span class="min-w-0 flex-1 truncate">{:__($navItem.name)}</span>
                            {if $navItem.id == $__CHANNEL__.id}
                            <i class="fa fa-check text-black/70" aria-hidden="true"></i>
                            {else}
                            <i class="fa fa-angle-right text-gray-400" aria-hidden="true"></i>
                            {/if}
                        </a>
                        {/cms:channellist}
                    </nav>
                </div>
            </section>
            {/if}
            <!-- 热门文章 -->
            <section aria-labelledby="hot-articles-title">
                <div class="ui-card">
                    <h3 class="ui-card-header text-xs font-semibold tracking-[0.18em] text-gray-900" id="hot-articles-title"><i class="fa fa-fire mr-2 text-black/60" aria-hidden="true"></i>{:__('热门推荐')}</h3>
                    <div class="space-y-2 p-3">
                        {php}$hotCount = 0;{/php}
                        {cms:arclist id="item" orderby="views" orderway="DESC" limit="6"}
                        {php}$hotCount++;{/php}
                        <a href="{$item.url}" class="group block overflow-hidden border border-black/10 bg-transparent transition hover:bg-black/5 no-underline" title="{$item.title|htmlentities}">
                            <div class="aspect-[4/1] overflow-hidden bg-black/5">
                                <img src="{$item.image ?: '/assets/addons/cms/img/default.png'}" alt="{$item.title|htmlentities}" loading="lazy" class="h-full w-full object-cover transition duration-300 group-hover:scale-105" onerror="this.onerror=null;this.src='/assets/addons/cms/img/default.png'">
                            </div>
                            <div class="text-sm font-medium text-gray-900 truncate" style="padding:6px 8px;">{$item.title|htmlentities}</div>
                        </a>
                        {/cms:arclist}
                        {if $hotCount == 0}
                        <div class="border border-dashed border-gray-300 p-4 text-center text-sm text-gray-500">{:__('暂无热门文章')}</div>
                        {/if}
                    </div>
                </div>
            </section>
            
            
            <!-- 最新文章 -->
            <section aria-labelledby="recent-articles-title">
                <div class="ui-card">
                    <h3 class="ui-card-header text-xs font-semibold tracking-[0.18em] text-gray-900" id="recent-articles-title"><i class="fa fa-clock-o mr-2 text-black/60" aria-hidden="true"></i>{:__('最新发布')}</h3>
                    <div class="divide-y divide-gray-100">
                        {cms:arclist id="item" orderby="publishtime" orderway="DESC" limit="8"}
                        <a href="{$item.url}" title="{$item.title|htmlentities}" class="block px-4 py-3 text-sm text-gray-800/90 hover:bg-gray-50 hover:text-black no-underline">
                            <div class="font-medium leading-6 text-gray-900">{$item.title|htmlentities}</div>
                            <div class="mt-1 flex flex-wrap items-center gap-x-4 gap-y-1 text-xs text-gray-500">
                                <span><i class="fa fa-calendar mr-1" aria-hidden="true"></i>{$item.publishtime|date='Y-m-d',###}</span>
                                <span><i class="fa fa-eye mr-1" aria-hidden="true"></i>{$item.views}</span>
                            </div>
                        </a>
                        {/cms:arclist}
                    </div>
                </div>
            </section>
            
            <!-- Google AdSense 侧边栏广告 -->
            
            
            {include file="common/sidebar" /}
        </aside>
    </div>
</div>

