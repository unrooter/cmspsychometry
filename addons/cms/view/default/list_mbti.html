{layout name="common/layout" /}

<!-- SEO结构化数据 -->
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "CollectionPage",
  "name": "{$__CHANNEL__.seotitle ?: 'MBTI性格测试'}",
  "description": "{$__CHANNEL__.description ?: 'MBTI 16型人格测试，了解您的性格类型'}",
  "url": "{$__CHANNEL__.url}",
  "breadcrumb": {
    "@type": "BreadcrumbList",
    "itemListElement": [
      {php}
      $breadPos = 0;
      $breadcrumbs = \addons\cms\model\Channel::getBreadcrumb($__CHANNEL__??[], $__ARCHIVES__??[], $__TAGS__??[], $__PAGE__??[], $__DIYFORM__??[], $__SPECIAL__??[]);
      $breadTotal = count($breadcrumbs);
      {/php}
      {cms:breadcrumb id="item"}
      {php}$breadPos++;{/php}
      {
        "@type": "ListItem",
        "position": {$breadPos},
        "name": "{$item.name}",
        "item": "{$item.url}"
      }{php}if($breadPos < $breadTotal) echo ',';{/php}
      {/cms:breadcrumb}
    ]
  }
}
</script>

<div class="mbti-list-container mx-auto max-w-7xl px-4 py-10 sm:px-6 lg:px-8">
    <!-- SEO优化的面包屑导航 -->
    <nav aria-label="breadcrumb" class="mb-6">
        <ol class="flex flex-wrap items-center gap-x-1.5 gap-y-1 text-xs text-gray-500" itemscope itemtype="https://schema.org/BreadcrumbList">
            {php}$breadPos = 0;{/php}
            {cms:breadcrumb id="item"}
            {php}$breadPos++;{/php}
            <li class="inline-flex items-center" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
                {if $breadPos>1}<span class="mx-1 text-gray-300">›</span>{/if}
                <a class="no-underline hover:text-black" href="{$item.url}" itemprop="item"><span itemprop="name">{:__($item.name)}</span></a>
                <meta itemprop="position" content="{$breadPos}" />
            </li>
            {/cms:breadcrumb}
        </ol>
    </nav>

    <!-- SEO优化的页面头部 -->
    <header class="ui-card">
        <div class="ui-card-body">
        <div>
            <div class="flex flex-wrap items-center gap-3">
                <h1 class="text-lg font-semibold tracking-tight text-gray-900" itemprop="headline">{:__($__CHANNEL__.name ?: 'MBTI性格测试')}</h1>
                <span class="inline-flex items-center gap-2 rounded-full bg-black/5 px-3 py-1 text-xs font-semibold tracking-[0.14em] text-gray-900">
                    <i class="fa fa-check-circle" aria-hidden="true"></i>
                    {:__('MBTI 相关测评')}
                </span>
            </div>
            
            {if $__CHANNEL__.description}
            <div class="mt-3 text-sm leading-7 text-gray-600" itemprop="description">{$__CHANNEL__.description}</div>
            {else}
            <div class="mt-3 text-sm leading-7 text-gray-600" itemprop="description">{:__('MBTI（迈尔斯-布里格斯类型指标）是最流行的性格测试之一，帮助您了解自己的性格类型和优势特质')}</div>
            {/if}
            
            <!-- 子栏目快速导航 -->
            <nav class="mt-4 flex flex-wrap items-center gap-2" aria-label="{:__('子分类导航')}">
                <span class="inline-flex items-center gap-2 text-sm font-medium text-gray-700"><i class="fa fa-th-list" aria-hidden="true"></i>{:__('子分类')}</span>
                {php}$navType = $__CHANNEL__['parent_id'] > 0 ? $__CHANNEL__['parent_id'] : $__CHANNEL__['id'];{/php}
                {cms:channellist id="subchan" type="son" typeid="$navType" limit="6"}
                <a href="{$subchan.url}" class="ui-pill text-xs tracking-[0.14em] {if $subchan.id == $__CHANNEL__.id}ui-pill-active{/if}">{:__($subchan.name)}</a>
                {/cms:channellist}
            </nav>
        </div>
        </div>
    </header>

    <div class="mt-6 grid gap-6 lg:grid-cols-12">
        <main class="lg:col-span-9">
            <!-- MBTI测试列表 -->
            <section class="mbti-list-section" aria-label="{:__('MBTI测试列表')}">
                <div class="grid grid-cols-2 gap-4 sm:grid-cols-3 lg:grid-cols-4">
                    {cms:pagelist id="item"}
                    <article class="ui-card group overflow-hidden transition" itemscope itemtype="https://schema.org/Quiz">
                        <a href="{$item.url}" class="block" aria-label="{$item.title|htmlentities}">
                            <div class="relative aspect-square overflow-hidden bg-black/5">
                                <img src="{$item.image ?: '/assets/addons/cms/img/default.png'}" alt="{$item.title|htmlentities} - MBTI性格测试" title="{$item.title|htmlentities}" itemprop="image" loading="lazy" width="300" height="300" class="h-full w-full object-cover transition duration-300 group-hover:scale-105">
                                {if isset($item.tags) && $item.tags}
                                <div class="absolute left-2 top-2 flex flex-wrap gap-1">
                                    {volist name="item.tags" id="tag"}
                                    <span class="rounded-full bg-black/60 px-2 py-0.5 text-xs text-white">{$tag.title|htmlentities}</span>
                                    {/volist}
                                </div>
                                {/if}
                            </div>
                            <div class="p-4">
                                <h2 class="text-sm font-semibold leading-6 text-gray-900" itemprop="name">{$item.title|htmlentities}</h2>
                                {if $item.sub_title}
                                <p class="oh-clamp-2 mt-2 text-xs leading-6 text-gray-600" itemprop="description">{$item.sub_title|htmlentities}</p>
                                {/if}
                                <div class="mt-2 text-xs text-gray-500"><i class="fa fa-eye mr-1" aria-hidden="true"></i>{$item.views}</div>
                            </div>
                        </a>
                    </article>
                    {/cms:pagelist}
                </div>
                
                <!-- 分页 -->
                {include file="common/pageinfo" /}
            </section>
        </main>

        <aside class="space-y-6 lg:col-span-3">
            <!-- 热门MBTI测试 -->
            <section class="sidebar-widget hot-tests-widget" aria-labelledby="hot-tests-title">
                <div class="ui-card">
                    <h2 class="ui-card-header text-xs font-semibold tracking-[0.18em] text-gray-900" id="hot-tests-title"><i class="fa fa-fire mr-2 text-black/60" aria-hidden="true"></i>{:__('热门测试')}</h2>
                    <div class="p-2">
                    {php}$hotType = $__CHANNEL__['parent_id'] > 0 ? '' : 'son';{/php}
                    {cms:arclist id="hot" type="$hotType" channel="$__CHANNEL__.id" orderby="views" orderway="DESC" limit="5"}
                    <a class="flex items-start gap-3 rounded-md px-3 py-3 text-sm text-gray-800/90 hover:bg-gray-50 hover:text-black no-underline" href="{$hot.url}">
                        <div class="mt-0.5 inline-flex h-6 w-6 shrink-0 items-center justify-center rounded-full bg-black/5 text-xs font-semibold text-gray-900">{$i}</div>
                        <div class="min-w-0 flex-1">
                            <div class="truncate font-medium">{$hot.title|htmlentities|mb_substr=0,30}</div>
                            <div class="mt-1 text-xs text-gray-500"><i class="fa fa-eye mr-1" aria-hidden="true"></i>{$hot.views|default=0}</div>
                        </div>
                    </a>
                    {/cms:arclist}
                    </div>
                </div>
            </section>

            <!-- 快速分类导航 -->
            <section class="sidebar-widget category-widget-enhanced" aria-labelledby="category-title">
                <div class="ui-card">
                    <h2 class="ui-card-header text-xs font-semibold tracking-[0.18em] text-gray-900" id="category-title"><i class="fa fa-th-large mr-2 text-black/60" aria-hidden="true"></i>{:__('分类导航')}</h2>
                    <nav class="p-4">
                        <div class="grid grid-cols-2 gap-3">
                            <!-- 如果是子频道，显示父频道的所有子频道（兄弟频道） -->
                            {if $__CHANNEL__.parent_id > 0}
                            {cms:channellist id="sub" type="son" typeid="$__CHANNEL__.parent_id"}
                            <a href="{$sub.url}" class="flex items-center gap-3 rounded-lg border border-gray-200 bg-white px-3 py-3 text-sm text-gray-800/90 hover:bg-gray-50 hover:text-black no-underline {if $sub.id == $__CHANNEL__.id}border-gray-200 bg-gray-50 text-gray-900{/if}">
                                <span class="inline-flex h-9 w-9 items-center justify-center rounded-full bg-black/5 text-black/60"><i class="fa fa-folder-o" aria-hidden="true"></i></span>
                                <span class="min-w-0 flex-1 truncate">{:__($sub.name)}</span>
                            </a>
                            {/cms:channellist}
                            {else}
                            <!-- 如果是父频道，显示自己的子频道 -->
                            {cms:channellist id="sub" type="son" typeid="$__CHANNEL__.id"}
                            <a href="{$sub.url}" class="flex items-center gap-3 rounded-lg border border-gray-200 bg-white px-3 py-3 text-sm text-gray-800/90 hover:bg-gray-50 hover:text-black no-underline">
                                <span class="inline-flex h-9 w-9 items-center justify-center rounded-full bg-black/5 text-black/60"><i class="fa fa-folder-o" aria-hidden="true"></i></span>
                                <span class="min-w-0 flex-1 truncate">{:__($sub.name)}</span>
                            </a>
                            {/cms:channellist}
                            {/if}
                        </div>
                    </nav>
                </div>
            </section>

        </aside>
    </div>
</div>

